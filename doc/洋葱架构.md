洋葱架构（Onion Architecture），又称整洁架构（The Clean Architecture），是一种以**领域模型为核心**、通过分层实现**高内聚低耦合**的软件架构模式。其核心设计理念是**依赖倒置**，内层定义业务规则，外层处理技术细节，各层仅依赖更内层的抽象接口而非具体实现。

---

### 核心原则与分层结构
1. **分层依赖**  
   从内到外分为：
    - **领域模型层**：封装核心业务实体与规则（如订单、用户实体）
    - **领域服务层**：实现跨实体的复杂业务逻辑（如订单计价规则）
    - **应用服务层**：协调用例流程（如创建订单的步骤编排）
    - **基础设施层**：实现数据库、API等外部交互（如MySQL存储、REST接口）

   外层依赖内层，内层**不感知外层实现**，通过接口解耦。

2. **数据封装**  
   每层定义独立的数据结构（如DTO、Entity），跨层数据需转换格式，避免直接传递数据库对象或API参数。

3. **依赖倒置**  
   内层定义接口（如`IOrderRepository`），外层提供实现（如`OrderRepository`），通过依赖注入连接。

---

### 优势与挑战
**优势**：
- **可测试性**：核心业务逻辑可独立测试，Mock外部依赖
- **技术中立**：更换数据库或框架不影响领域层（如SQL切MongoDB）
- **可维护性**：业务变更仅需修改内层，降低影响范围

**挑战**：
- **复杂度高**：需严格分层设计，初期开发成本较高
- **性能损耗**：多层数据转换可能增加开销

---

### 与六边形架构对比
两者均遵循依赖倒置原则，但洋葱架构更强调**层次化分层**，六边形架构则通过**端口-适配器**对称处理输入/输出。例如：
- 洋葱架构中，领域层完全独立于基础设施
- 六边形架构中，核心通过适配器与外部交互，无严格层级限制

---

### 实践建议
1. **领域驱动设计（DDD）结合**：通过聚合根、实体等模型构建核心层
2. **统一语言**：业务与开发团队使用一致术语定义接口
3. **框架选择**：Spring等DI框架简化依赖管理

示例代码结构（C#）：
```csharp
// 领域层接口
public interface IOrderService {
    void CreateOrder(Order order);
}

// 基础设施层实现
public class OrderRepository : IOrderService {
    public void CreateOrder(Order order) {
        // 数据库操作
    }
}
```

通过洋葱架构，可构建适应业务变化、技术中立的系统，尤其适合复杂业务场景（如电商、金融系统）。是否需要进一步了解具体实现细节？